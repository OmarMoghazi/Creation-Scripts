/* DDL for Table D_ACCOUNTS AND H_ACCOUNTS */

ALTER TABLE DWH_TST_DB.D_ACCOUNTS RENAME TO DWH_TST_DB.D_ACCOUNTS_SP1;

ALTER TABLE DWH_TST_DB.H_ACCOUNTS RENAME TO DWH_TST_DB.H_ACCOUNTS_SP1;

CREATE TABLE DWH_TST_DB.D_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				INT ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DWH_TST_DB.H_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				INT ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS PARQUET
TBLPROPERTIES	("PARQUET.COMPRESSION"="SNAPPY");


INSERT INTO DWH_TST_DB.D_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DWH_TST_DB.D_ACCOUNTS_SP1;



INSERT INTO DWH_TST_DB.H_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DWH_TST_DB.H_ACCOUNTS_SP1;



/* DDL for Table D_CARDS AND H_CARDS */

ALTER TABLE DWH_TST_DB.D_CARDS RENAME TO DWH_TST_DB.D_CARDS_SP1;

ALTER TABLE DWH_TST_DB.H_CARDS RENAME TO DWH_TST_DB.H_CARDS_SP1;

CREATE TABLE DWH_TST_DB.D_CARDS (
CARD_ID				   		  INT,
PAN				     		  STRING,
MASK_PAN			     	  	  STRING,
BIN			            	  	  STRING,
MBR				    	 	  INT,
DWH_ID				     	  	  INT,
CATEGORY_ID			     		  INT,
CARD_SCHEME_ID			    	 	  INT,
CARD_TYPE_ID			    		  INT,
BRN_ID				     	 	  INT,
BASE						  STRING	
,MISID						  STRING	
,ISSUEDATE					  INT	
,EXPIRYDATE					  INT	
,CARD_STATUS_ID				  	  INT	
,MOB						  STRING	
,PRIMARY_ACCT_ID			  	  INT	
,PRIMARY_ACCT_TYPE			  	  STRING	
,SECONDARY_ACCT_ID			 	  INT	
,SECONDARY_ACCT_TYPE				  STRING	
,TXNCODE					  STRING	
,PKVI						  STRING	
,PVV						  STRING	
,ACCT_CURRENCY_ID				  STRING	
,CARD_NUM					  STRING	
,CARD_PRODUCT_ID			 	  INT		
,LAST_STATEMENT_DT			  	  STRING	
,NAME_ON_CARD				  	  STRING	
,CARD_ONLINE_STATUS			  	  STRING	
,PRIMARY_SUPPLEMENTARY_FLAG	  		  STRING	
,COMPASS_ACCT_NUM			 	  STRING	
,CUSTOMER_ADDR				          STRING	
,MAIL_ADDR2					  STRING	
,MAIL_ADDR3					  STRING	
,PASSPORT_NUM				  	  STRING	
,NAME_TRANSLITERATION		  		  STRING	
,HOME_PHONE					  STRING	
,WORK_PHONE					  STRING	
,FAX						  STRING	
,ACTIVATION_DT				  	  INT	
,SELLER_NAME				  	  STRING		
,CREDIT_CARD_SCHEME_ID		 		  INT
,FLG_SECURED					  INT
,GUARANTEE_ACC1				  	  STRING
,GUARANTEE_ACC2				  	  STRING	
,GUARANTEE_ACC3				  	  STRING	
,GUARANTEE_ACC4				  	  STRING	
,CONTRACT_NUM				  	  STRING	
,CONTRACT_TYPE				  	  STRING	
,CONTRACT_STAT				  	  STRING	
,CONTRACT_STATUS			  	  STRING	
,PARENT_PAN					  STRING	
,FINANCIAL_PROFILE_NAME		  		  STRING	
,DAF_PROFILE_NAME			 	  STRING	
,INTEREST_PROFILE_NAME		 		  STRING	
,MIN_PAYMENT_PROFILE_NAME	  		  STRING	
,GENDER						  STRING	
,AGE						  INT	
,EDUCATION					  STRING	
,MARITAL_STATUS_ID			  	  INT	
,OCCUPATION					  STRING	
,ISSUANCE_REASON			  	  STRING	
,BLOCK_FOR_REISSUE			  	  STRING	
,COMPANY					  STRING	
,ORGANIZATION				  	  STRING	
,EXTERNAL_ACCT				  	  INT	
,LINKED_CONTRACT			  	  STRING	
,ACCT_CLIENT_NAME			  	  STRING	
,ACCT_STATE					  STRING	
,DOMESTIC_MP_PROFILE		  		  STRING	
,INTERNATIONAL_MP_PROFILE	  		  STRING	
,LINKED_CARDS				  	  STRING	
,LINKED_VALID_CARDS			  	  STRING	
,ACCT_DAF_PROFILE_NAME_DOM	  		  STRING	
,ACCT_DAF_PROFILE_NAME_INT	  		  STRING
,TABLENAME					  STRING
,CARDKEY					  STRING
,ROWHASH					  STRING
,BUSINESS_DT				  	  INT
)CLUSTERED BY (DWH_ID, CARD_NUM, PAN, CATEGORY_ID) INTO 16 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DWH_TST_DB.H_CARDS (
CARD_ID				   		  INT,
PAN				     		  STRING,
MASK_PAN			     	  	  STRING,
BIN			            	          STRING,
MBR				    	 	  INT,
DWH_ID				     	  	  INT,
CATEGORY_ID			     	  	  INT,
CARD_SCHEME_ID			     		  INT,
CARD_TYPE_ID			      		  INT,
BRN_ID				     	 	  INT,
BASE						  STRING	
,MISID						  STRING	
,ISSUEDATE					  INT	
,EXPIRYDATE					  INT	
,CARD_STATUS_ID				 	  INT	
,MOB						  STRING	
,PRIMARY_ACCT_ID			  	  INT	
,PRIMARY_ACCT_TYPE			  	  STRING	
,SECONDARY_ACCT_ID			  	  INT	
,SECONDARY_ACCT_TYPE		  		  STRING	
,TXNCODE					  STRING	
,PKVI						  STRING	
,PVV						  STRING	
,ACCT_CURRENCY_ID			  	  STRING	
,CARD_NUM					  STRING	
,CARD_PRODUCT_ID			  	  INT		
,LAST_STATEMENT_DT			  	  STRING	
,NAME_ON_CARD				  	  STRING	
,CARD_ONLINE_STATUS			  	  STRING	
,PRIMARY_SUPPLEMENTARY_FLAG	  		  STRING	
,COMPASS_ACCT_NUM			  	  STRING	
,CUSTOMER_ADDR				  	  STRING	
,MAIL_ADDR2					  STRING	
,MAIL_ADDR3					  STRING	
,PASSPORT_NUM				  	  STRING	
,NAME_TRANSLITERATION		  		  STRING	
,HOME_PHONE					  STRING	
,WORK_PHONE					  STRING	
,FAX						  STRING	
,ACTIVATION_DT				  	  INT	
,SELLER_NAME				  	  STRING		
,CREDIT_CARD_SCHEME_ID		  		  INT
,FLG_SECURED					  INT
,GUARANTEE_ACC1				  	  STRING
,GUARANTEE_ACC2				  	  STRING	
,GUARANTEE_ACC3				  	  STRING	
,GUARANTEE_ACC4				  	  STRING	
,CONTRACT_NUM				  	  STRING	
,CONTRACT_TYPE				  	  STRING	
,CONTRACT_STAT				  	  STRING	
,CONTRACT_STATUS			  	  STRING	
,PARENT_PAN					  STRING	
,FINANCIAL_PROFILE_NAME		 		  STRING	
,DAF_PROFILE_NAME			  	  STRING	
,INTEREST_PROFILE_NAME		  		  STRING	
,MIN_PAYMENT_PROFILE_NAME	  		  STRING	
,GENDER						  STRING	
,AGE						  INT	
,EDUCATION					  STRING	
,MARITAL_STATUS_ID			  	  INT	
,OCCUPATION					  STRING	
,ISSUANCE_REASON			  	  STRING	
,BLOCK_FOR_REISSUE			  	  STRING	
,COMPANY					  STRING	
,ORGANIZATION				  	  STRING	
,EXTERNAL_ACCT				  	  INT	
,LINKED_CONTRACT			  	  STRING	
,ACCT_CLIENT_NAME			  	  STRING	
,ACCT_STATE					  STRING	
,DOMESTIC_MP_PROFILE		 		  STRING	
,INTERNATIONAL_MP_PROFILE	  		  STRING	
,LINKED_CARDS				  	  STRING	
,LINKED_VALID_CARDS			 	  STRING	
,ACCT_DAF_PROFILE_NAME_DOM	  		  STRING	
,ACCT_DAF_PROFILE_NAME_INT	  		  STRING
,TABLENAME					  STRING
,CARDKEY					  STRING
,ROWHASH					  STRING
,BUSINESS_DT				  	  INT
)CLUSTERED BY (DWH_ID, CARD_NUM, PAN, CATEGORY_ID) INTO 16 BUCKETS
STORED AS PARQUET
TBLPROPERTIES    ("PARQUET.COMPRESSION"="SNAPPY");



INSERT INTO DWH_TST_DB.D_CARDS
(
CARD_ID				     
,PAN				     
,MASK_PAN			     
,`BIN`			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS				
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1			
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,INTEREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,INTERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT	
)
SELECT
ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS						
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1			
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,INTEREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,INTERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT
FROM DWH_TST_DB.D_CARDS_SP1;



INSERT INTO DWH_TST_DB.H_CARDS
(
CARD_ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS				
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1			
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,INTEREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,INTERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT	
)
SELECT
ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS						
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1			
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,INTEREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,INTERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT
FROM DWH_TST_DB.H_CARDS_SP1;


/* DDL for Table D_PRODUCT AND H_PRODUCT */

ALTER TABLE DWH_TST_DB.D_PRODUCT RENAME TO DWH_TST_DB.D_PRODUCT_SP1;

ALTER TABLE DWH_TST_DB.H_PRODUCT RENAME TO DWH_TST_DB.H_PRODUCT_SP1;

CREATE TABLE DWH_TST_DB.D_PRODUCT (
	PROD_ID					INT,
	SUB_PROD_ID				INT,
	CLUBBING_ID				INT,
	Prod_COD				String ,
	Prod_Desc_AR				String ,
	Prod_Desc_EN				String ,
	Is_Islamic				String ,
	PROD_START_DT				INT,
	Expiry_DT				INT,
	FLG_BOOK_COLL_BAL			String ,
	Module_ID				INT,
	Prod_Type_ID				INT,
	CCY_ID					INT,
	FLG_FORMAL				INT,
	FLG_SECURED				INT,
	FLG_IS_CBE_INITIATIVE			INT,
	MAKER_ID				String ,
	CHECKER_ID				String ,
	Last_MNT_DT				INT,
	ROWHASH					String ,
	Business_DT				INT
)CLUSTERED BY (PROD_COD,MODULE_ID) INTO 4 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DWH_TST_DB.H_PRODUCT (
	PROD_ID					INT,
	SUB_PROD_ID				INT,
	CLUBBING_ID				INT,
	Prod_COD				String ,
	Prod_Desc_AR				String ,
	Prod_Desc_EN				String ,
	Is_Islamic				String ,
	PROD_START_DT				INT,
	Expiry_DT				INT,
	FLG_BOOK_COLL_BAL			String ,
	Module_ID				INT,
	Prod_Type_ID				INT,
	CCY_ID					INT,
	FLG_FORMAL				INT,
	FLG_SECURED				INT,
	FLG_IS_CBE_INITIATIVE			INT,
	MAKER_ID				String ,
	CHECKER_ID				String ,
	Last_MNT_DT				INT,
	ROWHASH					String ,
	Business_DT				INT
)CLUSTERED BY (PROD_COD,MODULE_ID) INTO 4 BUCKETS
STORED AS PARQUET
TBLPROPERTIES	("PARQUET.COMPRESSION"="SNAPPY");


INSERT INTO DWH_TST_DB.D_PRODUCT
(
PROD_ID				,
PROD_COD			,
PROD_DESC_AR			,
PROD_DESC_EN			,
IS_ISLAMIC			,
PROD_START_DT			,
EXPIRY_DT			,
FLG_BOOK_COLL_BAL		,
MODULE_ID			,
PROD_TYPE_ID			,
CCY_ID				,
MAKER_ID			,
CHECKER_ID			,
LAST_MNT_DT			,
ROWHASH				,
BUSINESS_DT				
)
SELECT
ID				,
PROD_COD			,
PROD_DESC_AR			,
PROD_DESC_EN			,
IS_ISLAMIC			,
START_DT			,
EXPIRY_DT			,
FLG_BOOK_COLL_BAL		,
MODULE_ID			,
PROD_TYPE_ID			,
CCY_ID				,
MAKER_ID			,
CHECKER_ID			,
LAST_MNT_DT			,
ROWHASH				,
BUSINESS_DT			
FROM DWH_TST_DB.D_PRODUCT_SP1;


INSERT INTO DWH_TST_DB.H_PRODUCT
(
PROD_ID				,
PROD_COD			,
PROD_DESC_AR			,
PROD_DESC_EN			,
IS_ISLAMIC			,
PROD_START_DT			,
EXPIRY_DT			,
FLG_BOOK_COLL_BAL		,
MODULE_ID			,
PROD_TYPE_ID			,
CCY_ID				,
MAKER_ID			,
CHECKER_ID			,
LAST_MNT_DT			,
ROWHASH				,
BUSINESS_DT				
)
SELECT
ID				,
PROD_COD			,
PROD_DESC_AR			,
PROD_DESC_EN			,
IS_ISLAMIC			,
START_DT			,
EXPIRY_DT			,
FLG_BOOK_COLL_BAL		,
MODULE_ID			,
PROD_TYPE_ID			,
CCY_ID				,
MAKER_ID			,
CHECKER_ID			,
LAST_MNT_DT			,
ROWHASH				,
BUSINESS_DT			
FROM DWH_TST_DB.H_PRODUCT_SP1;


/* DDL for Table F_ACCOUNTS */

ALTER TABLE DWH_TST_DB.F_ACCOUNTS RENAME TO DWH_TST_DB.F_ACCOUNTS_SP1;

CREATE TABLE DWH_TST_DB.F_ACCOUNTS (
F_ACCT_ID					INT,
ACCT_ID						INT,
MODULE_ID					INT,
DWH_ID						INT,
PROD_ID						INT,
CCY_ID						INT,
DEP_NO_COD					INT,
OUTSTANDING_BAL					DOUBLE,
PRINCIPAL_OVERDUE_AMT				DOUBLE,
AMT_ARREARS_NONACC				DOUBLE,
INT_OVERDUE_AMT					DOUBLE,
AMT_ARREARS_PMI_NACC				DOUBLE,
BAL_BOOK					DOUBLE,
DISBURSED_AMT					DOUBLE,
AMT_ARREARS_CHARGES				DOUBLE,
AMT_ARREARS_SUSP_FEES				DOUBLE,
AMT_INTONARR					DOUBLE,
AMT_IOAC					DOUBLE,
AMT_ARREARS_PREMIUM				DOUBLE,
AMT_ARREARS_SUSP_PREMIUM			DOUBLE,
AMT_ARREARS_LEGAL				DOUBLE,
AMT_ARREARS_LEGAL_SUSP				DOUBLE,
AMT_ARREARS_OUTGOING				DOUBLE,
AMT_ARREARS_OUTGOING_SUSP			DOUBLE,
PRINC_UNEARNED_AMT				DOUBLE,
INT_UNEARNED_AMT				DOUBLE,
BAL_FOR_RATE_UNEARNED				DOUBLE,
RAT_EFFECTIVE_DT				DOUBLE,
BAL_FOR_RATE_EARNED				DOUBLE,
RAT_DEP_INT					DOUBLE,
RAT_DEP_INT_VAR					DOUBLE,
BAL_PENALTY_PAID				DOUBLE,
BAL_SERVICE_CHARGE				DOUBLE,
BAL_INT_ACCR					DOUBLE,
BAL_LAST_INT_ACCR				DOUBLE,
BAL_INT_COMP					DOUBLE,
BAL_LAST_INT_COMP				DOUBLE,
BAL_INT_PAID					DOUBLE,
BAL_LAST_INT_PAID				DOUBLE,
BAL_INT_PAID_CURR				DOUBLE,
BAL_LAST_INT_CAP				DOUBLE,
BAL_INT_CAP					DOUBLE,
BAL_UNCOLLEC_INT				DOUBLE,
BAL_UNCOLLEC_PRINC				DOUBLE,
BAL_UNCLAIM_PRINC				DOUBLE,
BAL_UNCLAIM_INT					DOUBLE,
AMT_TAX_ACCR					DOUBLE,
AMT_DISCOUNTED_INT				DOUBLE,
BAL_TAX_ON_DISC_INT				DOUBLE,
BAL_INT_DUE					DOUBLE,
BAL_PRINC_DUE					DOUBLE,
BAL_INT_WITHELD					DOUBLE,
BAL_INT_WITHELD_TOT				DOUBLE,
BAL_INT_COMP_PRETAX				DOUBLE,
BAL_TAX_WITHELD_TOT				DOUBLE,
AMT_ARREARS_CAP					DOUBLE,
AMT_ARREARS_PMI					DOUBLE,
CTR_INSTALL					DOUBLE,
LAST_PAYMENT_DT					INT,
RAT_INT_CURRENT					DOUBLE
)
PARTITIONED BY (BUSINESS_DT	INT
)CLUSTERED BY (ACCT_ID) INTO 32 BUCKETS
STORED AS PARQUET
TBLPROPERTIES	("PARQUET.COMPRESSION"="SNAPPY");

INSERT INTO DWH_TST_DB.F_ACCOUNTS
(
F_ACCT_ID					,
ACCT_ID						,
MODULE_ID					,
DWH_ID						,
PROD_ID						,
CCY_ID						,
DEP_NO_COD					,
OUTSTANDING_BAL					,
PRINCIPAL_OVERDUE_AMT				,
AMT_ARREARS_NONACC				,
INT_OVERDUE_AMT					,
AMT_ARREARS_PMI_NACC				,
BAL_BOOK					,
DISBURSED_AMT					,
AMT_ARREARS_CHARGES				,
AMT_ARREARS_SUSP_FEES				,
AMT_INTONARR					,
AMT_IOAC					,
AMT_ARREARS_PREMIUM				,
AMT_ARREARS_SUSP_PREMIUM			,
AMT_ARREARS_LEGAL				,
AMT_ARREARS_LEGAL_SUSP				,
AMT_ARREARS_OUTGOING				,
AMT_ARREARS_OUTGOING_SUSP			,
PRINC_UNEARNED_AMT				,
INT_UNEARNED_AMT				,
BAL_FOR_RATE_UNEARNED				,
RAT_EFFECTIVE_DT				,
BAL_FOR_RATE_EARNED				,
RAT_DEP_INT					,
RAT_DEP_INT_VAR					,
BAL_PENALTY_PAID				,
BAL_SERVICE_CHARGE				,
BAL_INT_ACCR					,
BAL_LAST_INT_ACCR				,
BAL_INT_COMP					,
BAL_LAST_INT_COMP				,
BAL_INT_PAID					,
BAL_LAST_INT_PAID				,
BAL_INT_PAID_CURR				,
BAL_LAST_INT_CAP				,
BAL_INT_CAP					,
BAL_UNCOLLEC_INT				,
BAL_UNCOLLEC_PRINC				,
BAL_UNCLAIM_PRINC				,
BAL_UNCLAIM_INT					,
AMT_TAX_ACCR					,
AMT_DISCOUNTED_INT				,
BAL_TAX_ON_DISC_INT				,
BAL_INT_DUE					,
BAL_PRINC_DUE					,
BAL_INT_WITHELD					,
BAL_INT_WITHELD_TOT				,
BAL_INT_COMP_PRETAX				,
BAL_TAX_WITHELD_TOT			
)
SELECT
FA.ID						,
DA.ACCT_ID 					,
FA.MODULE_ID					,
FA.DWH_ID					,
FA.PROD_ID					,
FA.CCY_ID					,
FA.DEP_NO_COD					,
FA.OUTSTANDING_BAL				,
FA.PRINCIPAL_OVERDUE_AMT			,
FA.AMT_ARREARS_NONACC				,
FA.INT_OVERDUE_AMT				,
FA.AMT_ARREARS_PMI_NACC				,
FA.BAL_BOOK					,
FA.DISBURSED_AMT				,
FA.AMT_ARREARS_CHARGES				,
FA.AMT_ARREARS_SUSP_FEES			,
FA.AMT_INTONARR					,
FA.AMT_IOAC					,
FA.AMT_ARREARS_PREMIUM				,
FA.AMT_ARREARS_SUSP_PREMIUM			,
FA.AMT_ARREARS_LEGAL				,
FA.AMT_ARREARS_LEGAL_SUSP			,
FA.AMT_ARREARS_OUTGOING				,
FA.AMT_ARREARS_OUTGOING_SUSP			,
FA.PRINC_UNEARNED_AMT				,
FA.INT_UNEARNED_AMT				,
FA.BAL_FOR_RATE_UNEARNED			,
FA.RAT_EFFECTIVE_DT				,
FA.BAL_FOR_RATE_EARNED				,
FA.RAT_DEP_INT					,
FA.RAT_DEP_INT_VAR				,
FA.BAL_PENALTY_PAID				,
FA.BAL_SERVICE_CHARGE				,
FA.BAL_INT_ACCR					,
FA.BAL_LAST_INT_ACCR				,
FA.BAL_INT_COMP					,
FA.BAL_LAST_INT_COMP				,
FA.BAL_INT_PAID					,
FA.BAL_LAST_INT_PAID				,
FA.BAL_INT_PAID_CURR				,
FA.BAL_LAST_INT_CAP				,
FA.BAL_INT_CAP					,
FA.BAL_UNCOLLEC_INT				,
FA.BAL_UNCOLLEC_PRINC				,
FA.BAL_UNCLAIM_PRINC				,
FA.BAL_UNCLAIM_INT				,
FA.AMT_TAX_ACCR					,
FA.AMT_DISCOUNTED_INT				,
FA.BAL_TAX_ON_DISC_INT				,
FA.BAL_INT_DUE					,
FA.BAL_PRINC_DUE				,
FA.BAL_INT_WITHELD				,
FA.BAL_INT_WITHELD_TOT				,
FA.BAL_INT_COMP_PRETAX				,
FA.BAL_TAX_WITHELD_TOT			
FROM DWH_TST_DB.F_ACCOUNTS_SP1 FA
JOIN DWH_TST_DB.D_ACCOUNTS DA 
ON FA.ACCT_NO = DA.ACCT_NO
AND
FA.DEP_NO_COD = DA.DEP_NO_COD
--AND 
--BUSINESS_DT = 20211231;


