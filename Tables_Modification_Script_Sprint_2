/* DDL for Table D_ACCOUNTS AND H_ACCOUNTS */

ALTER TABLE DEFAULT.D_ACCOUNTS RENAME TO DEFAULT.D_ACCOUNTS_SP1;

ALTER TABLE DEFAULT.H_ACCOUNTS RENAME TO DEFAULT.H_ACCOUNTS_SP1;

CREATE TABLE DEFAULT.D_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				String ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DEFAULT.H_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				String ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS PARQUET
TBLPROPERTIES	("PARQUET.COMPRESSION"="SNAPPY");


INSERT INTO DEFAULT.D_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DEFAULT.D_ACCOUNTS_SP1;



INSERT INTO DEFAULT.H_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DEFAULT.H_ACCOUNTS_SP1;
