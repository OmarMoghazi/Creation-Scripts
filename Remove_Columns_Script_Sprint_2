/* DDL for Table D_ACCOUNTS AND H_ACCOUNTS */

ALTER TABLE DEFAULT.D_ACCOUNTS RENAME TO DEFAULT.D_ACCOUNTS_SP1;

ALTER TABLE DEFAULT.H_ACCOUNTS RENAME TO DEFAULT.H_ACCOUNTS_SP1;

CREATE TABLE DEFAULT.D_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				String ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DEFAULT.H_ACCOUNTS (
	ACCT_ID					INT,
	CIF					String ,
	DWH_ID					INT,
	PROD_ID					INT,
	THIRD_PARTY_ID				INT,
	CCY_ID					INT,
	BRN_ID					INT,
	LANGUAGE_ID				INT,
	STATUS_ID				INT,
	ACCT_NO					String ,
	IBAN					String ,
	REMITTER_ACCT_COD			String ,
	DEP_NO_COD				INT,
	ACCT_CLOSE_DT				INT,
	MATURITY_DT				INT,
	VALUE_DT				INT,
	BOOK_DT					INT,
	LIQUIDATION_DT				INT,
	EVENT_COD				STRING,
	OPERATION				STRING,
	TENOR					DOUBLE ,
	FLG_ACCRUAL				String ,
	ROWHASH					String,
	BUSINESS_DT				INT
)PARTITIONED BY (MODULE_ID	INT)
CLUSTERED BY (ACCT_NO,DWH_ID,PROD_ID,BRN_ID) INTO 16 BUCKETS
STORED AS PARQUET
TBLPROPERTIES	("PARQUET.COMPRESSION"="SNAPPY");


INSERT INTO DEFAULT.D_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DEFAULT.D_ACCOUNTS_SP1;



INSERT INTO DEFAULT.H_ACCOUNTS
(
ACCT_ID,		
CIF	                ,			   
DWH_ID              	,			
ACCT_NO             	,			
IBAN                	,			
PROD_ID             	,			
CCY_ID	            	,		
BRN_ID	            	,		
REMITTER_ACCT_COD   	,
DEP_NO_COD	        ,	
ACCT_CLOSE_DT	    	,
MATURITY_DT		,
VALUE_DT		,
BOOK_DT			,
LIQUIDATION_DT	   	,
EVENT_COD		,
OPERATION		,
STATUS_ID		,
LANGUAGE_ID		,
ROWHASH			,
BUSINESS_DT		,
MODULE_ID)
SELECT
ID                 		,				
CIF				,
DWH_ID				,	
ACCT_NO				,	
IBAN				,	
PROD_ID				,	
CCY_ID				,	
BRN_ID				,	
REMITTER_ACCT_COD		,	
DEP_NO_COD			,		
ACCT_CLOSE_DT			,
MATURITY_DT			,
VALUE_DT			,
BOOK_DT				,
LIQUIDATION_DT			,
EVENT_COD			,
OPERATION			,
STATUS_ID			,
LANGUAGE_ID			,
ROWHASH				,
BUSINESS_DT			,
MODULE_ID
FROM DEFAULT.H_ACCOUNTS_SP1;



/* DDL for Table D_CARDS AND H_CARDS */

ALTER TABLE DEFAULT.D_CARDS RENAME TO DEFAULT.D_CARDS_SP1;

ALTER TABLE DEFAULT.H_CARDS RENAME TO DEFAULT.H_CARDS_SP1;

CREATE TABLE DEFAULT.D_CARDS (
CARD_ID				   		  INT,
PAN				     		  STRING,
MASK_PAN			     	  	  STRING,
BIN			            	  	  STRING,
MBR				    	 	  INT,
DWH_ID				     	  	  INT,
CATEGORY_ID			     		  INT,
CARD_SCHEME_ID			    	 	  INT,
CARD_TYPE_ID			    		  INT,
BRN_ID				     	 	  INT,
BASE						  STRING	
,MISID						  STRING	
,ISSUEDATE					  INT	
,EXPIRYDATE					  INT	
,CARD_STATUS_ID				  	  INT	
,MOB						  STRING	
,PRIMARY_ACCT_ID			  	  INT	
,PRIMARY_ACCT_TYPE			  	  STRING	
,SECONDARY_ACCT_ID			 	  INT	
,SECONDARY_ACCT_TYPE				  STRING	
,TXNCODE					  STRING	
,PKVI						  STRING	
,PVV						  STRING	
,ACCT_CURRENCY_ID				  STRING	
,CARD_NUM					  STRING	
,CARD_PRODUCT_ID			 	  INT		
,LAST_STATEMENT_DT			  	  STRING	
,NAME_ON_CARD				  	  STRING	
,CARD_ONLINE_STATUS			  	  STRING	
,PRIMARY_SUPPLEMENTARY_FLAG	  		  STRING	
,COMPASS_ACCT_NUM			 	  STRING	
,CUSTOMER_ADDR				          STRING	
,MAIL_ADDR2					  STRING	
,MAIL_ADDR3					  STRING	
,PASSPORT_NUM				  	  STRING	
,NAME_TRANSLITERATION		  		  STRING	
,HOME_PHONE					  STRING	
,WORK_PHONE					  STRING	
,FAX						  STRING	
,ACTIVATION_DT				  	  INT	
,SELLER_NAME				  	  STRING		
,CREDIT_CARD_SCHEME_ID		 		  INT
,FLG_SECURED					  INT
,GUARANTEE_ACC1				  	  STRING
,GUARANTEE_ACC2				  	  STRING	
,GUARANTEE_ACC3				  	  STRING	
,GUARANTEE_ACC4				  	  STRING	
,CONTRACT_NUM				  	  STRING	
,CONTRACT_TYPE				  	  STRING	
,CONTRACT_STAT				  	  STRING	
,CONTRACT_STATUS			  	  STRING	
,PARENT_PAN					  STRING	
,FINANCIAL_PROFILE_NAME		  		  STRING	
,DAF_PROFILE_NAME			 	  STRING	
,INTEREST_PROFILE_NAME		 		  STRING	
,MIN_PAYMENT_PROFILE_NAME	  		  STRING	
,GENDER						  STRING	
,AGE						  INT	
,EDUCATION					  STRING	
,MARITAL_STATUS_ID			  	  INT	
,OCCUPATION					  STRING	
,ISSUANCE_REASON			  	  STRING	
,BLOCK_FOR_REISSUE			  	  STRING	
,COMPANY					  STRING	
,ORGANIZATION				  	  STRING	
,EXTERNAL_ACCT				  	  INT	
,LINKED_CONTRACT			  	  STRING	
,ACCT_CLIENT_NAME			  	  STRING	
,ACCT_STATE					  STRING	
,DOMESTIC_MP_PROFILE		  		  STRING	
,INTERNATIONAL_MP_PROFILE	  		  STRING	
,LINKED_CARDS				  	  STRING	
,LINKED_VALID_CARDS			  	  STRING	
,ACCT_DAF_PROFILE_NAME_DOM	  		  STRING	
,ACCT_DAF_PROFILE_NAME_INT	  		  STRING
,TABLENAME					  STRING
,CARDKEY					  STRING
,ROWHASH					  STRING
,BUSINESS_DT				  	  INT
)CLUSTERED BY (DWH_ID, CARD_NUM, PAN, CATEGORY_ID) INTO 16 BUCKETS
STORED AS ORC
TBLPROPERTIES	('TRANSACTIONAL'='TRUE', "ORC.COMPRESS"="SNAPPY");


CREATE TABLE DEFAULT.H_CARDS (
CARD_ID				   		  INT,
PAN				     		  STRING,
MASK_PAN			     	  	  STRING,
BIN			            	          STRING,
MBR				    	 	  INT,
DWH_ID				     	  	  INT,
CATEGORY_ID			     	  	  INT,
CARD_SCHEME_ID			     		  INT,
CARD_TYPE_ID			      		  INT,
BRN_ID				     	 	  INT,
BASE						  STRING	
,MISID						  STRING	
,ISSUEDATE					  INT	
,EXPIRYDATE					  INT	
,CARD_STATUS_ID				 	  INT	
,MOB						  STRING	
,PRIMARY_ACCT_ID			  	  INT	
,PRIMARY_ACCT_TYPE			  	  STRING	
,SECONDARY_ACCT_ID			  	  INT	
,SECONDARY_ACCT_TYPE		  		  STRING	
,TXNCODE					  STRING	
,PKVI						  STRING	
,PVV						  STRING	
,ACCT_CURRENCY_ID			  	  STRING	
,CARD_NUM					  STRING	
,CARD_PRODUCT_ID			  	  INT		
,LAST_STATEMENT_DT			  	  STRING	
,NAME_ON_CARD				  	  STRING	
,CARD_ONLINE_STATUS			  	  STRING	
,PRIMARY_SUPPLEMENTARY_FLAG	  		  STRING	
,COMPASS_ACCT_NUM			  	  STRING	
,CUSTOMER_ADDR				  	  STRING	
,MAIL_ADDR2					  STRING	
,MAIL_ADDR3					  STRING	
,PASSPORT_NUM				  	  STRING	
,NAME_TRANSLITERATION		  		  STRING	
,HOME_PHONE					  STRING	
,WORK_PHONE					  STRING	
,FAX						  STRING	
,ACTIVATION_DT				  	  INT	
,SELLER_NAME				  	  STRING		
,CREDIT_CARD_SCHEME_ID		  		  INT
,FLG_SECURED					  INT
,GUARANTEE_ACC1				  	  STRING
,GUARANTEE_ACC2				  	  STRING	
,GUARANTEE_ACC3				  	  STRING	
,GUARANTEE_ACC4				  	  STRING	
,CONTRACT_NUM				  	  STRING	
,CONTRACT_TYPE				  	  STRING	
,CONTRACT_STAT				  	  STRING	
,CONTRACT_STATUS			  	  STRING	
,PARENT_PAN					  STRING	
,FINANCIAL_PROFILE_NAME		 		  STRING	
,DAF_PROFILE_NAME			  	  STRING	
,INTEREST_PROFILE_NAME		  		  STRING	
,MIN_PAYMENT_PROFILE_NAME	  		  STRING	
,GENDER						  STRING	
,AGE						  INT	
,EDUCATION					  STRING	
,MARITAL_STATUS_ID			  	  INT	
,OCCUPATION					  STRING	
,ISSUANCE_REASON			  	  STRING	
,BLOCK_FOR_REISSUE			  	  STRING	
,COMPANY					  STRING	
,ORGANIZATION				  	  STRING	
,EXTERNAL_ACCT				  	  INT	
,LINKED_CONTRACT			  	  STRING	
,ACCT_CLIENT_NAME			  	  STRING	
,ACCT_STATE					  STRING	
,DOMESTIC_MP_PROFILE		 		  STRING	
,INTERNATIONAL_MP_PROFILE	  		  STRING	
,LINKED_CARDS				  	  STRING	
,LINKED_VALID_CARDS			 	  STRING	
,ACCT_DAF_PROFILE_NAME_DOM	  		  STRING	
,ACCT_DAF_PROFILE_NAME_INT	  		  STRING
,TABLENAME					  STRING
,CARDKEY					  STRING
,ROWHASH					  STRING
,BUSINESS_DT				  	  INT
)CLUSTERED BY (DWH_ID, CARD_NUM, PAN, CATEGORY_ID) INTO 16 BUCKETS
STORED AS PARQUET
TBLPROPERTIES    ("PARQUET.COMPRESSION"="SNAPPY");



INSERT INTO DEFAULT.D_CARDS
(
CARD_ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS				
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1		
,GUARANTEE_COD		
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,EREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,ERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT	
)
SELECT
ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS						
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1		
,GUARANTEE_COD		
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,EREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,ERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT
FROM DEFAULT.D_CARDS_SP1;



INSERT INTO DEFAULT.H_CARDS
(
CARD_ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS				
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1		
,GUARANTEE_COD		
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,EREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,ERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT	
)
SELECT
ID				     
,PAN				     
,MASK_PAN			     
,BIN			             
,MBR				     
,DWH_ID				     
,CATEGORY_ID			     
,CARD_SCHEME_ID			     
,CARD_TYPE_ID			     
,BRN_ID				    
,BASE		
,MISID		
,ISSUEDATE		
,EXPIRYDATE		
,CARD_STATUS_ID		
,MOB		
,PRIMARY_ACCT_ID		
,PRIMARY_ACCT_TYPE		
,SECONDARY_ACCT_ID		
,SECONDARY_ACCT_TYPE		
,TXNCODE		
,PKVI		
,PVV		
,ACCT_CURRENCY_ID		
,CARD_NUM		
,CARD_PRODUCT_ID				
,LAST_STATEMENT_DT		
,NAME_ON_CARD		
,CARD_ONLINE_STATUS						
,PRIMARY_SUPPLEMENTARY_FLAG		
,COMPASS_ACCT_NUM		
,CUSTOMER_ADDR		
,MAIL_ADDR2		
,MAIL_ADDR3		
,PASSPORT_NUM		
,NAME_TRANSLITERATION		
,HOME_PHONE		
,WORK_PHONE		
,FAX		
,ACTIVATION_DT		
,SELLER_NAME		
,GUARANTEE_ACC1		
,GUARANTEE_COD		
,GUARANTEE_ACC2		
,GUARANTEE_ACC3		
,GUARANTEE_ACC4		
,CONTRACT_NUM		
,CONTRACT_TYPE		
,CONTRACT_STAT		
,CONTRACT_STATUS		
,PARENT_PAN		
,FINANCIAL_PROFILE_NAME		
,DAF_PROFILE_NAME		
,EREST_PROFILE_NAME		
,MIN_PAYMENT_PROFILE_NAME		
,GENDER		
,AGE		
,EDUCATION		
,MARITAL_STATUS_ID		
,OCCUPATION		
,ISSUANCE_REASON		
,BLOCK_FOR_REISSUE		
,COMPANY		
,ORGANIZATION		
,EXTERNAL_ACCT		
,LINKED_CONTRACT		
,ACCT_CLIENT_NAME		
,ACCT_STATE		
,DOMESTIC_MP_PROFILE		
,ERNATIONAL_MP_PROFILE		
,LINKED_CARDS		
,LINKED_VALID_CARDS		
,ACCT_DAF_PROFILE_NAME_DOM		
,ACCT_DAF_PROFILE_NAME_INT	
,TABLENAME	
,CARDKEY	
,ROWHASH	
,BUSINESS_DT
FROM DEFAULT.H_CARDS_SP1;
